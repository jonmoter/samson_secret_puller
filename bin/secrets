#!/usr/bin/env ruby
loop do
  sleep 10
end
require_relative "../lib/secrets.rb"

VAULT_ADDRESS = ENV.fetch("VAULT_ADDR", false)
VAULT_AUTH_PEM = ENV.feth("VAULT_AUTH_PEM", '/vault-auth/pem')
VAULT_TLS_VERIFY = ENV.feth("VAULT_TLS_VERIFY", false)
SIDECAR_SECRET_PATH = ENV.fetch("SIDECAR_SECRET_PATH", '/secrets/')

raise "VAULT_ADDR not provided" unless VAULT_ADDRESS

client = SecretsClient.new(VAULT_AUTH_PEM, VAULT_ADDRESS, VAULT_TLS_VERIFY, 'SIDECAR_SECRET_PATH')

loop do
  client.process
  sleep 60
end
